# Plan de Implementación y Pruebas Avanzadas

**Proyecto:**  Lanzamiento de la Plataforma de Alquiler Express

**Módulo:** Administración de Sistemas Informáticos en Red (ASIR)

**Autor:** Antonio López Montes

**Fecha:** 23 de Diciembre de 2025

---

## 1. Especificación de Componentes de Alta Disponibilidad y Resiliencia

Esta sección detalla la configuración exacta de los componentes críticos para asegurar la alta disponibilidad (SLA 99.9%) y la recuperación ante desastres (RTO 4h, RPO 1h).

### 1.1. Configuración del Balanceador de Carga (Load Balancer)

Se implementará un balanceador de carga Nginx en el Servidor Web (DMZ) para distribuir el tráfico de entrada entre múltiples Servidores de Aplicación (en caso de escalabilidad futura) y garantizar la continuidad del servicio.

| Parámetro | Configuración | Justificación |
| :--- | :--- | :--- |
| **Algoritmo de Balanceo** | **Least Connection** | Dirige el tráfico al servidor con menos conexiones activas. Esto optimiza el rendimiento al asegurar que todos los servidores trabajen de manera equitativa. |
| **Health Check (Verificación de Salud)** | TCP en puerto 8080 (Servidor de Aplicación) | Se realiza una verificación cada 5 segundos. Si el servidor no responde después de 3 intentos, se marca como *DOWN* y se retira del *pool* de balanceo. |
| **Persistencia de Sesión** | Cookie de Sesión (Sticky Session) | Esencial para aplicaciones de reserva. Asegura que un usuario permanezca conectado al mismo Servidor de Aplicación durante toda su sesión de reserva para evitar la pérdida de datos del carrito o del proceso de pago. |
| **Protocolo** | Terminación SSL/TLS | El balanceador gestiona el cifrado (HTTPS) y reenvía el tráfico sin cifrar a los Servidores de Aplicación internos, reduciendo la carga de CPU en los servidores de *backend*. |

### 1.2. Esquema de Replicación de Base de Datos (MySQL)

Para cumplir con el RPO de 1 hora y asegurar la redundancia de datos, se implementará una arquitectura de replicación **Master-Slave** (Maestro-Esclavo).

| Parámetro | Configuración | Justificación |
| :--- | :--- | :--- |
| **Tipo de Replicación** | **Asíncrona** (Inicialmente) | El Maestro no espera la confirmación del Esclavo, priorizando la velocidad de escritura. Suficiente para el MVP, pero se planificará la migración a Semisíncrona. |
| **Configuración** | Basada en **Binlog** (Binary Log) | El Maestro registra todas las transacciones en el Binlog, que el Esclavo lee y aplica. Esto garantiza la consistencia de los datos. |
| **Failover** | Manual (Inicialmente) | En caso de fallo del Maestro, el Administrador de Sistemas promoverá manualmente al Esclavo como nuevo Maestro. Se planificará la automatización con herramientas como Orchestrator. |
| **Uso del Esclavo** | Solo para **Backups** y **Consultas de Lectura** | El Esclavo se utilizará para realizar copias de seguridad sin impactar el rendimiento del Maestro, y para descargar consultas de lectura pesadas (ej. informes). |

### 1.3. Configuración de Replicación de Directorio Activo (AD-DC)

El Controlador de Dominio (AD-DC) es crítico para la autenticación de administradores y dispositivos IoT. Aunque inicialmente se implementará un solo AD-DC, la configuración debe prever la replicación.

| Parámetro | Configuración | Justificación |
| :--- | :--- | :--- |
| **Sitios (Sites)** | **Un único sitio** (`QuickStay-HQ`) | Suficiente para la fase inicial, ya que todos los servidores están en la misma ubicación lógica (VLAN 30). |
| **Frecuencia de Replicación** | **Inmediata** (por defecto) | Los cambios críticos (ej. alta de un administrador) se replican inmediatamente para asegurar la consistencia de la autenticación. |
| **Plan de Expansión** | **AD-DC Secundario** | Se planificará la adición de un segundo AD-DC en la VLAN 30 para redundancia total y *failover* automático en caso de fallo del servidor principal. |

### 1.4. Estrategia de Backups (Copia de Seguridad)

La estrategia de backups es fundamental para cumplir con el RPO de 1 hora. Se utilizará una combinación de tipos de backup y la regla **3-2-1**.

| Tipo de Backup | Frecuencia | Componentes | Justificación |
| :--- | :--- | :--- | :--- |
| **Completo** | Semanal (Domingo 02:00 AM) | Todos los servidores (SO, Aplicación, DB) | Base para la restauración completa del sistema. |
| **Diferencial** | Diario (Lunes a Sábado 02:00 AM) | Cambios desde el último backup completo. | Reduce el tiempo de restauración al requerir solo el último completo y el último diferencial. |
| **Transaccional (Binlog)** | Cada hora | Base de Datos (MySQL) | Permite la recuperación a un punto específico en el tiempo (Point-in-Time Recovery) para cumplir con el RPO de 1 hora. |

**Regla 3-2-1:**
*   **3 Copias:** Datos originales + 2 copias.
*   **2 Medios:** Almacenamiento local (Servidor de Backups) + Almacenamiento en la nube (ej. S3).
*   **1 Off-site:** Una copia almacenada fuera de la ubicación principal (la copia en la nube).

---

## 2. Plan de Pruebas Detallado

Antes del despliegue final, se ejecutará un plan de pruebas riguroso para validar la infraestructura y la seguridad.

### 2.1. Pruebas de Failover y Resiliencia

| Prueba | Objetivo | Metodología | Criterio de Éxito |
| :--- | :--- | :--- | :--- |
| **Failover del Balanceador** | Verificar que el tráfico se redirige automáticamente si un servidor falla. | Simular el fallo del Servidor de Aplicación (ej. detener el servicio Java) y medir el tiempo de reconexión. | El tráfico debe ser redirigido al servidor activo en menos de 10 segundos (tiempo de *health check*). |
| **Failover de Base de Datos** | Verificar la promoción del Esclavo a Maestro. | Detener el servicio MySQL en el Maestro y ejecutar el procedimiento de promoción manual del Esclavo. | El Esclavo debe asumir el rol de Maestro y aceptar escrituras en menos de 30 minutos (cumpliendo el RTO). |
| **Recuperación de Backups** | Verificar que los datos se pueden restaurar al RPO de 1 hora. | Simular la pérdida de datos en la DB y restaurar el último backup diferencial + los logs transaccionales de la última hora. | Restauración completa y funcional de la DB en menos de 4 horas (cumpliendo el RTO). |

### 2.2. Pruebas de Carga y Rendimiento

| Prueba | Objetivo | Herramienta | Criterio de Éxito |
| :--- | :--- | :--- | :--- |
| **Prueba de Carga (Stress Test)** | Simular 500 usuarios concurrentes realizando reservas. | Apache JMeter o Locust. | El tiempo de respuesta de la API de reservas debe ser inferior a 500 ms. |
| **Prueba de Escalabilidad** | Medir el rendimiento al añadir un segundo Servidor de Aplicación. | JMeter. | El rendimiento (transacciones por segundo) debe aumentar al menos un 80% con el nuevo servidor. |

### 2.3. Pruebas de Seguridad

| Prueba | Objetivo | Herramienta | Criterio de Éxito |
| :--- | :--- | :--- | :--- |
| **Scanning de Vulnerabilidades** | Identificar vulnerabilidades conocidas en los servidores y aplicaciones. | Nessus o OpenVAS. | Puntuación de seguridad A+ en el Servidor Web (DMZ). No se deben detectar vulnerabilidades críticas o altas. |
| **Prueba de Penetración Básica** | Validar la Matriz de Acceso y las reglas del Firewall. | Intentar acceder a la VLAN 20 (Servicios) desde la VLAN 10 (DMZ) por puertos no autorizados. | El Firewall debe denegar el 100% de los intentos de conexión no autorizados. |
| **Detección de Intrusiones (Wazuh/Suricata)** | Verificar que el Servidor de Seguridad detecta y alerta sobre eventos maliciosos. | Simular un ataque de fuerza bruta SSH. | Wazuh debe generar una alerta de nivel alto y Suricata debe registrar el evento. |

---

## 3. Cronograma y Asignación de Recursos

### 3.1. Checklist de Hitos Críticos

| Hito | Fecha Límite (Semana) | Responsable | Criterio de Finalización |
| :--- | :--- | :--- | :--- |
| **Hito 1: Red Segmentada** | Semana 3 | Administrador de Sistemas | Configuración funcional de VLANs y Firewall (iptables) en el Router/Firewall. |
| **Hito 2: Servicios Base** | Semana 5 | Administrador de Sistemas | Servidores Web, App, DB y AD-DC instalados y funcionales con IP estática. |
| **Hito 3: Integración IoT** | Semana 9 | Técnico IoT | Centralitas IoT autenticadas contra el AD-DC y reportando estado al Servidor de Monitoreo. |
| **Hito 4: Seguridad Operativa** | Semana 10 | Administrador de Sistemas | Servidor de Seguridad (Wazuh/Suricata) operativo y generando alertas. Estrategia de Backups implementada. |
| **Hito 5: Despliegue Final** | Semana 11 | Equipo de Pruebas | 100% de las pruebas de Failover, Carga y Seguridad superadas. Documentación finalizada. |

### 3.2. Plan de Contingencia por Retrasos

| Escenario de Riesgo | Impacto Estimado | Plan de Contingencia |
| :--- | :--- | :--- |
| **Retraso en la Fase 2 (Implementación de Servidores)** | Retraso de 1 semana en el proyecto. | **Recursos Adicionales:** Asignar un segundo Administrador de Sistemas a tiempo parcial para acelerar la configuración de VLANs y AD-DC. |
| **Fallo en Pruebas de Carga (Semana 10)** | Necesidad de optimizar el código de la aplicación o la configuración de la DB. | **Priorización:** Detener temporalmente las pruebas de seguridad para dedicar los recursos del equipo a la optimización del rendimiento. |
| **Problemas de Integración IoT** | Retraso en la Fase 4. | **Solución Temporal:** Implementar un sistema de acceso manual temporal (ej. códigos de un solo uso) mientras se resuelve la autenticación AD-DC/IoT. |
