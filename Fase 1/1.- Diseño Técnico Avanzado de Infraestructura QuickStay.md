# Diseño Técnico Avanzado de Infraestructura

**Proyecto:** Lanzamiento de la Plataforma de Alquiler Express

**Módulo:** Administración de Sistemas Informáticos en Red (ASIR)

**Autor:** Antonio López Montes

**Fecha:** 23 de Diciembre de 2025

---

## 1. Revisión y Documentación de Requisitos Ampliados

La infraestructura de QuickStay debe cumplir con requisitos de disponibilidad y recuperación ante desastres de nivel empresarial para garantizar la continuidad del servicio de reservas y el control de acceso IoT.

### 1.1. Requisitos de Alta Disponibilidad (HA) y Continuidad del Negocio

Para asegurar la confianza del usuario y la operatividad 24/7, se establecen los siguientes objetivos de servicio:

| Métrica | Objetivo | Justificación |
| :--- | :--- | :--- |
| **SLA (Acuerdo de Nivel de Servicio)** | **99.9%** de Uptime Anual | Este objetivo equivale a un máximo de **8 horas y 45 minutos** de inactividad total al año. Es un estándar de alta disponibilidad que minimiza el impacto en las reservas y el acceso a las propiedades. |
| **RTO (Objetivo de Tiempo de Recuperación)** | **4 horas** | El tiempo máximo permitido para restaurar el servicio principal (reservas y acceso) después de un fallo catastrófico. Un RTO de 4 horas permite la intervención manual y la restauración de la infraestructura crítica. |
| **RPO (Objetivo de Punto de Recuperación)** | **1 hora** | La cantidad máxima de datos que se pueden perder, lo que implica que las copias de seguridad de la base de datos deben realizarse, al menos, cada hora. |

### 1.2. Justificación de Componentes Añadidos: Servidor de Seguridad

Se ha añadido un **Servidor de Seguridad dedicado (SIEM/IDS)** para centralizar y aislar las funciones de defensa de la red, mejorando la postura de seguridad de QuickStay.

| Componente | Función | Justificación Técnica |
| :--- | :--- | :--- |
| **Servidor de Seguridad** | Alojamiento de Wazuh (SIEM/HIDS) y Suricata (IDS/IPS). | **Aislamiento:** Al separar las herramientas de seguridad del Servidor de Gestión (Zabbix/AD-DC), se evita que un compromiso en el servidor de monitoreo afecte a las herramientas de detección de intrusiones. **Rendimiento:** El procesamiento de logs (Wazuh) y el análisis de tráfico (Suricata) son tareas intensivas que requieren recursos dedicados, garantizando que no impacten en el rendimiento del Controlador de Dominio o del Servidor de Monitoreo. |

---

## 2. Diseño de Red Mejorado

El diseño de red se basa en la segmentación estricta mediante VLANs para aislar el tráfico por nivel de riesgo y función.

### 2.1. Subnetting Completo y Plan de Direccionamiento IP

Se ha elegido la red **172.16.0.0/16** para la red corporativa interna, lo que proporciona **65.534 direcciones IP** y una amplia capacidad de expansión.

| VLAN | Nombre de Zona | Subred (CIDR) | Rango de Hosts | Máscara | Uso | Hosts Reservados |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **VLAN 10** | DMZ (Web) | **172.16.10.0/24** | 172.16.10.1 - 254 | 255.255.255.0 | Servidor Web (Estático) | 172.16.10.10 |
| **VLAN 20** | Servicios (App/DB) | **172.16.20.0/24** | 172.16.20.1 - 254 | 255.255.255.0 | Servidor App, Servidor DB (Estático) | 172.16.20.10, 172.16.20.20 |
| **VLAN 30** | Gestión (AD/Monitoreo/Seguridad) | **172.16.30.0/24** | 172.16.30.1 - 254 | 255.255.255.0 | AD-DC, Zabbix, Wazuh/Suricata (Estático) | 172.16.30.10, 172.16.30.20, 172.16.30.30 |
| **VLAN 40** | OT/IoT (Operación) | **172.16.40.0/23** | 172.16.40.1 - 41.254 | 255.255.254.0 | Centralitas IoT (DHCP) | 510 Hosts (Gran expansión) |
| **VLAN 50** | Administración (VPN) | **172.16.50.0/26** | 172.16.50.1 - 62 | 255.255.255.192 | Conexiones VPN de Administradores (DHCP) | 62 Hosts |
| **VLAN 60** | Futura Expansión | **172.16.60.0/24** | 172.16.60.1 - 254 | 255.255.255.0 | Reservada | 254 Hosts |

**Plan de Direccionamiento:**
*   **IP Estática:** Todos los servidores (Web, App, DB, AD-DC, Monitoreo, Seguridad) utilizarán IP estática para garantizar la estabilidad y la resolución DNS.
*   **DHCP:** Se utilizará DHCP para la **VLAN 40 (IoT)** y la **VLAN 50 (Administración VPN)** para facilitar la gestión de un gran número de dispositivos y usuarios remotos.

### 2.2. Tablas de Enrutamiento Inter-VLAN

El **Router/Firewall** actuará como *gateway* principal y será el encargado de enrutar el tráfico entre las VLANs, aplicando las políticas de seguridad definidas en la Matriz de Acceso.

| Red Destino | Máscara | Siguiente Salto (Next Hop) | Interfaz de Salida |
| :--- | :--- | :--- | :--- |
| 172.16.10.0 | 255.255.255.0 | Directamente Conectado | VLAN 10 (DMZ) |
| 172.16.20.0 | 255.255.255.0 | Directamente Conectado | VLAN 20 (Servicios) |
| 172.16.30.0 | 255.255.255.0 | Directamente Conectado | VLAN 30 (Gestión) |
| 172.16.40.0 | 255.255.254.0 | Directamente Conectado | VLAN 40 (OT/IoT) |
| 0.0.0.0 | 0.0.0.0 | IP del Proveedor (ISP) | Interfaz WAN |

### 2.3. Diseño de Zonas DNS

El **Controlador de Dominio (AD-DC)** en la VLAN 30 será el servidor DNS primario para la red interna.

| Tipo de Zona | Nombre de Zona | Función | Registros Clave |
| :--- | :--- | :--- | :--- |
| **Forward Lookup** | `quickstay.local` | Resolución de nombres de servidores a IP (ej. `app.quickstay.local` -> 172.16.20.10). | A (Host), CNAME (Alias), MX (Mail) |
| **Reverse Lookup** | `16.172.in-addr.arpa` | Resolución de IP a nombres de servidores (ej. 172.16.20.10 -> `app.quickstay.local`). | PTR (Pointer) |

---

## 3. Diseño de Seguridad

El diseño de seguridad se basa en el principio de **Mínimo Privilegio** y la defensa en profundidad, controlando estrictamente el flujo de tráfico entre las zonas.

### 3.1. Matriz de Acceso entre VLANs (Firewall Policy)

La matriz define qué tráfico está **permitido** entre las zonas. Todo el tráfico no especificado está **denegado** por defecto.

| Origen (VLAN) | Destino (VLAN) | Protocolo/Puerto | Justificación |
| :--- | :--- | :--- | :--- |
| **Internet** | DMZ (10) | TCP/80, 443 (HTTP/S) | Acceso público a la plataforma web. |
| **DMZ (10)** | Servicios (20) | TCP/8080 (App Server) | El Servidor Web accede al Servidor de Aplicación para procesar peticiones. |
| **Servicios (20)** | Servicios (20) | TCP/3306 (MySQL) | El Servidor de Aplicación accede a la Base de Datos. |
| **Servicios (20)** | Gestión (30) | UDP/53 (DNS), TCP/389 (LDAP) | Consulta al AD-DC para autenticación y resolución de nombres. |
| **Gestión (30)** | Todas | TCP/22 (SSH), ICMP | Administración y monitoreo de todos los servidores. |
| **OT/IoT (40)** | Gestión (30) | TCP/53, 8086 (IoT-AD/Monitoreo) | Las centralitas IoT se autentican contra el AD-DC y envían datos al Servidor de Monitoreo. |
| **Admin VPN (50)** | Gestión (30) | TCP/22 (SSH), 3389 (RDP) | Acceso seguro de administradores a los servidores de gestión. |

### 3.2. Reglas de Firewall Específicas (Ejemplos iptables)

Las siguientes son reglas de ejemplo que se implementarán en el Router/Firewall (o en el servidor Linux que actúe como *gateway* de cada VLAN) para aplicar la Matriz de Acceso.

```bash
# 1. Permitir tráfico de Internet a Servidor Web (DMZ)
iptables -A FORWARD -i eth_wan -o eth_dmz -p tcp --dport 80 -d 172.16.10.10 -j ACCEPT
iptables -A FORWARD -i eth_wan -o eth_dmz -p tcp --dport 443 -d 172.16.10.10 -j ACCEPT

# 2. Permitir tráfico de Servidor Web (DMZ) a Servidor de Aplicación (Servicios)
iptables -A FORWARD -i eth_dmz -o eth_servicios -p tcp --dport 8080 -s 172.16.10.10 -d 172.16.20.10 -j ACCEPT

# 3. Permitir tráfico de Servidor de Aplicación a Base de Datos (Servicios)
# Nota: Esta regla se aplica en el firewall del Servidor de Base de Datos
iptables -A INPUT -p tcp --dport 3306 -s 172.16.20.10 -j ACCEPT

# 4. Denegar todo el tráfico no especificado (Política por defecto)
iptables -P FORWARD DROP
```

### 3.3. Plan de Hardening de Servidores

Se aplicará un plan de *hardening* (endurecimiento) a todos los servidores Linux para minimizar la superficie de ataque:

1.  **Actualizaciones:** Configuración de actualizaciones automáticas de seguridad (unattended-upgrades).
2.  **SSH:** Deshabilitar el acceso root por SSH, usar autenticación por clave pública/privada y cambiar el puerto por defecto (ej. 2222).
3.  **Usuarios:** Implementación de políticas de contraseñas fuertes y uso de `sudo` en lugar de `root` para tareas administrativas.
4.  **Servicios:** Deshabilitar todos los servicios innecesarios (ej. telnet, ftp, servicios gráficos).
5.  **Auditoría:** Instalación de agentes de **Wazuh** en todos los servidores para monitorizar la integridad de los archivos críticos y la actividad del sistema.

---

## 4. Conclusión

Este documento proporciona el diseño detallado necesario para la Fase Diseño de Arquitectura, cumpliendo con los requisitos de alta disponibilidad, seguridad avanzada y escalabilidad. El diseño de red segmentado y la matriz de acceso estricta son la base para una infraestructura robusta y segura.
